@page
@model Web.Areas.Admin.Pages.Students.CourseEnrollmentModel
@{
}

<h1>@Model.Student.FullName</h1>
<br />

<div class="form-group">
    <label asp-for="Semesters" class="form-label"></label>
    <select asp-for="Semester.Id" class="form-control" asp-items="ViewBag.SemesterId">
    </select>
</div>

<div class="form-group">
    <label asp-for="Course" class="form-label"></label>
    <select asp-for="Course.Id" class="form-control"
            asp-items="ViewBag.CourseId" id="courseDropDown"
            onchange="getSections()">
        <option value="" disabled selected style="display:none;">Select Course</option>
    </select>
</div>

<div class="form-group">
    <label asp-for="Section" class="form-label"></label>

    <select asp-for="Section.Id" class="form-control"
            id="sectionDropDown" onchange="getSeats()">
        <option value="" disabled selected style="display:none;">Select Course</option>
    </select>
</div>
<br />
<div class="form-group">
    <label class="form-label">Seats Available :</label>
    <label class="form-label" id="seatCount"></label>
</div>
<br />
<table class="table table-striped table-hover" id="compolsoryTable">
    <thead class="thead-dark">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Course.Code)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Course.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Course.Credits)
            </th>
            <th></th>
        </tr>
    </thead>

    <tbody>
        @foreach (var enrollment in Model.Student.Enrollments)
        {
            <tr>
                <td>@enrollment.Section.Course.Code</td>
                <td>@enrollment.Section.Course.Name</td>
                <td>@enrollment.Section.Course.Credits</td>
                <td>
                    <form method="post">
                        <input type="hidden" value="@enrollment.Section.Id" />
                        <input type="hidden" asp-for="Course.Id" />


                        <input type="submit" value="Remove"
                               class="btn btn-primary btn-danger"
                               asp-page-handler="DeleteCourse" />
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<script>
    function getSections() {
        var dd = document.getElementById('courseDropDown');
        fetch('http://' + window.location.hostname + ':' + window.location.port+ '/api/Course/' + dd.value)
            .then((response) => response.json())
            .then((data) => {
                let output = document.getElementById('sectionDropDown');
                let seatCount = document.getElementById('seatCount');
                seatCount.innerHTML = "";

                var i;
                for(i = output.options.length ; i >= 1 ; i--)
                {
                    output.remove(i);
                    console.log(2);
                }

                console.log(data.sections);
                (data.sections).forEach(function (section) {
                    var option = document.createElement("option");
                    option.value = section.id;
                    option.text = section.number;
                    output.add(option);
                })
            })

        }

    function getSeats() {
        var dd = document.getElementById('sectionDropDown');
        fetch('http://' + window.location.hostname + ':' + window.location.port+ '/api/Section/' + dd.value)
            .then((response) => response.json())
            .then((data) => {
                let output = document.getElementById('seatCount');
                output.innerHTML = data.seat;
            })
    }
</script>